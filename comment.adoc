== Oui mais qu'est-ce que j'en fait ?

=== !

image::raclette_simple.png[width="600px"]

[.notes]
--
On va commencer avec les cas simples, en prenant exemple sur une liste de course
--

[.use-case]
=== !

âœ”ï¸Pain de campagne, sinon baguette

[source, java]
----
private Optional<Pain> getPainDeCampagne() { /*TODO implement*/ }


Pain pain = getPainDeCampagne().orElse(baguette);
----

[.use-case]
=== !

âœ”ï¸Si le boucher du centre a de la charcuterie, sinon chez le boucher BEAUCOUP plus loin.

[source, java, highlight="1..7|9|20..21"]
----
private Optional<Charcuterie> getCharcuterieDuCentre() {
    /*TODO implement*/
}

private Charcuterie getCharcuteriePlusLoin() {
    /*TODO Je sens que Ã§a va Ãªtre long.. ğŸ’€*/
}

Charcuterie = getCharcuterieDuCentre().orElse(getCharcuteriePlusLoin());










Charcuterie = getCharcuterieDuCentre()
    .orElseGet(() -> getCharcuteriePlusLoin());
----

[.use-case]
=== !

âœ”ï¸Fromage Ã  raclette (ou core panic)

[source, java]
----
Fromage morbier = maybeFromage.orElseThrow(() -> new ThreadDeath());
----

[.notes]
--
Ici on aurait pu retourner directement une instance d'exception,
mais leur instanciation est couteuse Ã  cause du mÃ©canisme de rÃ©cupÃ©ration de stacktrace.
--

== !

image::todolist.png[width="600px"]

[.notes]
--
Quelques utilisations avancÃ©es.
--

[.use-case]
=== !

âœ”ï¸Si on trouve le prix du cadeau on le donne le prix, sinon on donne 20â‚¬.

[source, java]
----
double participation = cadeau
    .map(cadeau->cadeau.getPrix())
    .orElse(20l);
----

[.use-case]
=== !

âœ”ï¸Si le caviste a du Touraine, on en prend

[%step]
image::sonar.png[]

[.notes]
--
Ici on a envie de donner un optional Ã  une mÃ©thode

Alors lÃ  non !

Je prend ici mon baton de pelerin. Sonar c'est trÃ¨s bien. Mais ce n'est pas la vÃ©ritÃ© absolue ! Restez critique!
--

=== !

[source, java]
----
caviste.getTouraine().ifPresent(bouteille -> onEnPrend(bouteille));
----

[.notes]
--
On note ici l'appel conditionnel de mÃ©thode.
--

[.use-case]
=== !

âœ”ï¸Si le caviste a du Touraine ET qu'il n'est pas trop cher, on en prend.

[source, java]
----
caviste.getTouraine()
    .filter(bouteille -> pasTropCher(bouteille))
    .ifPresent(bouteille -> onEnPrend(bouteille));
----

[.notes]
--
On retrouve beaucoup des mÃ©thodes prÃ©sentent sur les streams.
--

[.use-case]
=== !

âœ”ï¸Si le primeur est ouvert ET quâ€™il a de la mangue, on prend, sinon de lâ€™ananas.

[source, java, highlight="1..2|6..7|11..119"]
----
maybePrimeur /*Optional<Primeur>*/
  .map(primeur -> primeur.getMangue());



maybePrimeur /*Optional<Primeur>*/
  .map(primeur -> primeur.getMangue()); /*Optional<Optional<Fruit>>*/



maybePrimeur /*Optional<Primeur>*/
  .flatMap(primeur -> primeur.getMangue()) /*Optional<Fruit>*/
  .orElse(new Ananas());
----

[.notes]
--
Attention aux optionals d'optionals
--

[.use-case]
=== !

âœ”ï¸Si je trouve les clefs dans mon sac je les utilise, sinon je passe par la fenÃªtre.

[source, java]
----
maybeClef
  .ifPresentOrElse(
      clef -> utilise(clef),
      () -> passeParLaFenÃªtre());
----

[.notes]
--
Si la seule chose que vous voulez faire c'est vÃ©rifier son absence, il existe `isEmpty()`, que vous devrez tester dans du if classique...
--